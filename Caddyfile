# main port. everything ends up here and this is what you connect to
http://localhost:8080, http://192.168.1.31:8080, http://192.168.1.32:8080 {
	# tile server
	route /map* {
		reverse_proxy localhost:5555 {
			transport fastcgi {
				# Caddy automatically sets common FastCGI params.
				# You can add or override environment variables if needed:
				# env MY_VARIABLE my_value
			}
		}
	}

	# backend
	reverse_proxy /api/* :5000

	# frontend
	reverse_proxy /* :8090

	handle_errors {
		@bad_gateway expression {http.error.status_code} == 502
		handle @bad_gateway {
			rewrite * /502.html
			file_server {
				root /srv
			}
		}

		# backup is http.cat
		handle {
			rewrite * /{http.error.status_code}
			reverse_proxy https://http.cat {
				header_up Host {upstream_hostport}
				replace_status {http.error.status_code}
			}
		}
	}
}
